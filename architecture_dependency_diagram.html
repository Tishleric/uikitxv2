<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIKitXv2 Architecture Dependency Map</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .section {
            margin: 30px 0;
        }
        .legend {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .legend ul {
            list-style: none;
            padding: 0;
        }
        .legend li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>UIKitXv2 Architecture Dependency Map</h1>
    
    <div class="legend">
        <h3>Legend</h3>
        <ul>
            <li>üî∑ Core Modules (Protocols/Base Classes)</li>
            <li>üé® UI Components</li>
            <li>üéØ Applications/Dashboards</li>
            <li>üîß Utilities/Services</li>
            <li>üé≠ Decorators</li>
            <li>üåê External APIs</li>
            <li>üìä Data Processing</li>
        </ul>
    </div>

    <div class="section">
        <h2>Complete System Architecture</h2>
        <p>The complete architecture is broken down into focused subsystems for better readability:</p>
        
        <h3>Core Foundation & UI Components</h3>
        <div class="mermaid">
graph LR
    %% Core Layer
    subgraph Core["üî∑ Core Layer"]
        BaseComponent["base_component.py"]
        DataServiceProtocol["data_service_protocol.py"]
        MermaidProtocol["mermaid_protocol.py"]
    end

    %% Utils
    subgraph Utils["üîß Utilities"]
        ColourPalette["colour_palette.py"]
    end

    %% Components
    subgraph Components["üé® UI Components"]
        Button["button.py"]
        Checkbox["checkbox.py"]
        ComboBox["combobox.py"]
        Container["container.py"]
        DataTable["datatable.py"]
        Graph["graph.py"]
        Grid["grid.py"]
        ListBox["listbox.py"]
        Mermaid["mermaid.py"]
        RadioButton["radiobutton.py"]
        RangeSlider["rangeslider.py"]
        Tabs["tabs.py"]
        Toggle["toggle.py"]
    end

    %% Dependencies
    Button --> BaseComponent
    Button --> ColourPalette
    Checkbox --> BaseComponent
    Checkbox --> ColourPalette
    ComboBox --> BaseComponent
    ComboBox --> ColourPalette
    Container --> BaseComponent
    Container --> ColourPalette
    DataTable --> BaseComponent
    DataTable --> ColourPalette
    Graph --> BaseComponent
    Graph --> ColourPalette
    Grid --> BaseComponent
    Grid --> ColourPalette
    ListBox --> BaseComponent
    ListBox --> ColourPalette
    Mermaid --> MermaidProtocol
    Mermaid --> ColourPalette
    RadioButton --> BaseComponent
    RadioButton --> ColourPalette
    RangeSlider --> BaseComponent
    RangeSlider --> ColourPalette
    Tabs --> BaseComponent
    Tabs --> ColourPalette
    Toggle --> BaseComponent
    Toggle --> ColourPalette

    classDef coreClass fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef componentClass fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef utilClass fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px

    class BaseComponent,DataServiceProtocol,MermaidProtocol coreClass
    class Button,Checkbox,ComboBox,Container,DataTable,Graph,Grid,ListBox,Mermaid,RadioButton,RangeSlider,Tabs,Toggle componentClass
    class ColourPalette utilClass
        </div>

        <h3>Logging & Monitoring System</h3>
        <div class="mermaid">
graph LR
    %% Context
    ContextVars["context_vars.py"]

    %% Decorators
    subgraph Decorators["üé≠ Decorators"]
        TraceCloser["trace_closer.py<br/>(Outermost)"]
        TraceMemory["trace_memory.py"]
        TraceCpu["trace_cpu.py"]
        TraceTime["trace_time.py<br/>(Innermost)"]
    end

    %% Logging
    subgraph Logging["üìù Logging System"]
        LoggingConfig["logging_config.py"]
        SQLiteHandler["sqlite_handler.py"]
    end

    %% Dependencies
    TraceCloser --> ContextVars
    TraceCloser --> LoggingConfig
    TraceMemory --> ContextVars
    TraceCpu --> ContextVars
    TraceTime --> ContextVars
    SQLiteHandler --> LoggingConfig

    %% Stacking order
    TraceCloser -.->|wraps| TraceMemory
    TraceMemory -.->|wraps| TraceCpu
    TraceCpu -.->|wraps| TraceTime

    classDef decoratorClass fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef utilClass fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px

    class TraceCloser,TraceMemory,TraceCpu,TraceTime decoratorClass
    class ContextVars,LoggingConfig,SQLiteHandler utilClass
        </div>

        <h3>ActantEOD Data Services</h3>
        <div class="mermaid">
graph LR
    %% Protocol
    DataServiceProtocol["data_service_protocol.py"]

    %% ActantEOD Services
    subgraph ActantEOD["üìä ActantEOD Services"]
        ActantDataService["data_service.py"]
        FileManager["file_manager.py"]
        DataIntegrityCheck["data_integrity_check.py"]
        ProcessActantJSON["process_actant_json.py"]
        PMRetrieval["pricing_monkey_retrieval.py"]
        PMProcessor["pricing_monkey_processor.py"]
    end

    %% External dependency
    PMoneySimple["pMoneySimpleRetrieval.py"]

    %% Dependencies
    ActantDataService --> DataServiceProtocol
    ActantDataService --> PMRetrieval
    ActantDataService --> PMProcessor
    PMRetrieval --> PMoneySimple
    FileManager --> ProcessActantJSON

    classDef coreClass fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef dataClass fill:#fff8e1,stroke:#f57f17,stroke-width:2px

    class DataServiceProtocol coreClass
    class ActantDataService,FileManager,DataIntegrityCheck,ProcessActantJSON,PMRetrieval,PMProcessor,PMoneySimple dataClass
        </div>

        <h3>ActantSOD & Pricing Monkey Services</h3>
        <div class="mermaid">
graph LR
    %% ActantSOD
    subgraph ActantSOD["üìä ActantSOD Services"]
        ActantPy["actant.py"]
        BrowserAuto["browser_automation.py"]
        FuturesUtils["futures_utils.py"]
        PMAdapter["pricing_monkey_adapter.py"]
        PMToActant["pricing_monkey_to_actant.py"]
    end

    %% Pricing Monkey
    subgraph PricingMonkey["üí∞ Pricing Monkey"]
        PMoneyAuto["pMoneyAuto.py"]
        PMoneyMovement["pMoneyMovement.py"]
        PMoneySimple["pMoneySimpleRetrieval.py"]
    end

    %% Dependencies
    ActantPy --> FuturesUtils
    PMAdapter --> FuturesUtils
    PMToActant --> PMAdapter
    PMToActant --> ActantPy
    PMToActant --> PMoneySimple
    BrowserAuto --> PMoneySimple

    classDef dataClass fill:#fff8e1,stroke:#f57f17,stroke-width:2px

    class ActantPy,BrowserAuto,FuturesUtils,PMAdapter,PMToActant,PMoneyAuto,PMoneyMovement,PMoneySimple dataClass
        </div>

        <h3>TT REST API Integration</h3>
        <div class="mermaid">
graph LR
    subgraph TTAPI["üåê TT REST API"]
        TokenManager["token_manager.py"]
        TTUtils["tt_utils.py"]
        TTConfig["tt_config.py"]
        APIExample["api_example.py"]
    end

    %% Dependencies
    TokenManager --> TTUtils
    TokenManager --> TTConfig
    APIExample --> TokenManager

    classDef apiClass fill:#e3f2fd,stroke:#0d47a1,stroke-width:2px

    class TokenManager,TTUtils,TTConfig,APIExample apiClass
        </div>

        <h3>Applications & Dashboards</h3>
        <div class="mermaid">
graph TD
    %% Component exports
    ComponentsInit["components/__init__.py"]

    %% Applications
    subgraph MainApps["üéØ Main Applications"]
        DashboardMain["dashboard.py"]
        DashboardEOD["dashboard_eod.py"]
    end

    subgraph DemoApps["üéØ Demo Applications"]
        DemoApp["demo/app.py"]
        DemoFlow["demo/flow.py"]
        QueryRunner["demo/query_runner.py"]
    end

    subgraph TestApps["üéØ Test Applications"]
        ScenarioLadder["scenario_ladder_v1.py"]
        ZNPriceTracker["zn_price_tracker_app.py"]
    end

    %% Key dependencies (simplified)
    DashboardMain --> ComponentsInit
    DashboardMain --> |uses all<br/>decorators| Decorators[Decorators]
    DashboardMain --> PMoneyAuto[pMoneyAuto.py]
    DashboardMain --> PMoneyMovement[pMoneyMovement.py]

    DashboardEOD --> ComponentsInit
    DashboardEOD --> ActantDataService[data_service.py]
    DashboardEOD --> FileManager[file_manager.py]

    DemoApp --> ComponentsInit
    DemoApp --> |uses all<br/>decorators| Decorators
    DemoFlow --> |uses all<br/>decorators| Decorators
    QueryRunner --> |uses timing<br/>decorators| Decorators

    ScenarioLadder --> ComponentsInit
    ScenarioLadder --> BrowserAutomation[browser_automation.py]

    ZNPriceTracker --> ComponentsInit
    ZNPriceTracker --> TokenManager[token_manager.py]

    classDef appClass fill:#f3e5f5,stroke:#4a148c,stroke-width:3px

    class DashboardMain,DashboardEOD,DemoApp,DemoFlow,QueryRunner,ScenarioLadder,ZNPriceTracker appClass
        </div>
    </div>

    <div class="section">
        <h2>Simplified High-Level View</h2>
        <div class="mermaid">
graph TD
    subgraph Foundation
        Core[Core Protocols & Base Classes]
        Utils[Utilities & Themes]
        Decorators[Logging Decorators]
    end

    subgraph UILayer[UI Layer]
        Components[UI Components<br/>14 components]
    end

    subgraph DataLayer[Data Layer]
        ActantEOD[ActantEOD Services]
        ActantSOD[ActantSOD Services]
        PricingMonkey[Pricing Monkey]
        TTAPI[TT REST API]
    end

    subgraph AppLayer[Application Layer]
        MainDash[Main Dashboard]
        EODDash[EOD Dashboard]
        DemoApps[Demo Applications]
        LadderApp[Ladder Application]
        PriceTracker[Price Tracker]
    end

    Core --> Components
    Utils --> Components
    Components --> AppLayer
    DataLayer --> AppLayer
    Decorators --> AppLayer
    Decorators --> DataLayer

    classDef foundationClass fill:#b3e5fc,stroke:#0277bd,stroke-width:3px
    classDef uiClass fill:#ffccbc,stroke:#bf360c,stroke-width:2px
    classDef dataClass fill:#dcedc8,stroke:#33691e,stroke-width:2px
    classDef appClass fill:#d1c4e9,stroke:#311b92,stroke-width:3px

    class Core,Utils,Decorators foundationClass
    class Components uiClass
    class ActantEOD,ActantSOD,PricingMonkey,TTAPI dataClass
    class MainDash,EODDash,DemoApps,LadderApp,PriceTracker appClass
        </div>
    </div>

    <div class="section">
        <h2>Key Architectural Patterns</h2>
        <div class="mermaid">
graph LR
    subgraph Patterns
        ABC[Abstract Base Classes<br/>Protocol Pattern]
        DI[Dependency Injection<br/>via Protocols]
        Decorator[Decorator Pattern<br/>for Logging]
        Theme[Centralized Theme<br/>Management]
    end

    ABC --> Example1[BaseComponent ‚Üí All UI Components]
    DI --> Example2[DataServiceProtocol ‚Üí ActantDataService]
    Decorator --> Example3[TraceCloser ‚Üí TraceTime ‚Üí TraceCpu ‚Üí TraceMemory]
    Theme --> Example4[colour_palette.py ‚Üí All Components]
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#f5f5f5',
                primaryTextColor: '#333',
                primaryBorderColor: '#ccc',
                lineColor: '#666',
                secondaryColor: '#e0e0e0',
                tertiaryColor: '#d0d0d0'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });
    </script>
</body>
</html> 